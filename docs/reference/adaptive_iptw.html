<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Compute asymptotically linear IPTW estimators with super learning
for the propensity score — adaptive_iptw • drtmle</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Compute asymptotically linear IPTW estimators with super learning
for the propensity score — adaptive_iptw" />
<meta property="og:description" content="Compute asymptotically linear IPTW estimators with super learning
for the propensity score" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">drtmle</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/using_drtmle.html">`drtmle`: Doubly-Robust Inference in R</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/benkeser/drtmle/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute asymptotically linear IPTW estimators with super learning
for the propensity score</h1>
    <small class="dont-index">Source: <a href='https://github.com/benkeser/drtmle/blob/master/R/adaptive_iptw.R'><code>R/adaptive_iptw.R</code></a></small>
    <div class="hidden name"><code>adaptive_iptw.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Compute asymptotically linear IPTW estimators with super learning
for the propensity score</p>
    </div>

    <pre class="usage"><span class='fu'>adaptive_iptw</span><span class='op'>(</span>
  <span class='va'>W</span>,
  <span class='va'>A</span>,
  <span class='va'>Y</span>,
  DeltaY <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>Y</span><span class='op'>)</span><span class='op'>)</span>,
  DeltaA <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>A</span><span class='op'>)</span><span class='op'>)</span>,
  stratify <span class='op'>=</span> <span class='cn'>FALSE</span>,
  family <span class='op'>=</span> <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span><span class='op'>(</span><span class='va'>Y</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>     <span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/family.html'>binomial</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span>    
    <span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/family.html'>gaussian</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>}</span>,
  a_0 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>A</span><span class='op'>[</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>A</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>,
  SL_g <span class='op'>=</span> <span class='cn'>NULL</span>,
  glm_g <span class='op'>=</span> <span class='cn'>NULL</span>,
  SL_Qr <span class='op'>=</span> <span class='cn'>NULL</span>,
  glm_Qr <span class='op'>=</span> <span class='cn'>NULL</span>,
  returnModels <span class='op'>=</span> <span class='cn'>TRUE</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>,
  maxIter <span class='op'>=</span> <span class='fl'>2</span>,
  tolIC <span class='op'>=</span> <span class='fl'>1</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>Y</span><span class='op'>)</span>,
  tolg <span class='op'>=</span> <span class='fl'>0.01</span>,
  cvFolds <span class='op'>=</span> <span class='fl'>1</span>,
  gn <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>W</th>
      <td><p>A <code>data.frame</code> of named covariates</p></td>
    </tr>
    <tr>
      <th>A</th>
      <td><p>A <code>numeric</code> vector of binary treatment assignment (assumed to
be equal to 0 or 1)</p></td>
    </tr>
    <tr>
      <th>Y</th>
      <td><p>A <code>numeric</code> numeric of continuous or binary outcomes.</p></td>
    </tr>
    <tr>
      <th>DeltaY</th>
      <td><p>A <code>numeric</code> indicator of missing outcome (assumed to be
equal to 0 if missing 1 if observed)</p></td>
    </tr>
    <tr>
      <th>DeltaA</th>
      <td><p>A <code>numeric</code> indicator of missing treatment (assumed to be
equal to 0 if missing 1 if observed)</p></td>
    </tr>
    <tr>
      <th>stratify</th>
      <td><p>A <code>logical</code> indicating whether to estimate the missing
outcome regression separately for observations with different levels of
<code>A</code> (if <code>TRUE</code>) or to pool across <code>A</code> (if <code>FALSE</code>).</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>A <code>family</code> object equal to either <code><a href='https://rdrr.io/r/stats/family.html'>binomial()</a></code> or
<code><a href='https://rdrr.io/r/stats/family.html'>gaussian()</a></code>, to be passed to the <code>SuperLearner</code> or <code>glm</code>
function.</p></td>
    </tr>
    <tr>
      <th>a_0</th>
      <td><p>A vector of <code>numeric</code> treatment values at which to return
marginal mean estimates.</p></td>
    </tr>
    <tr>
      <th>SL_g</th>
      <td><p>A vector of characters describing the super learner library to be
used for each of the propensity score regressions (<code>DeltaA</code>, <code>A</code>,
and <code>DeltaY</code>). To use the same library for each of the regressions (or
if there is no missing data in <code>A</code> nor <code>Y</code>), a single library may
be input. See <code>link{SuperLearner::SuperLearner}</code> for details on how
super learner libraries can be specified.</p></td>
    </tr>
    <tr>
      <th>glm_g</th>
      <td><p>A list of characters describing the formulas to be used
for each of the propensity score regressions (<code>DeltaA</code>, <code>A</code>, and
<code>DeltaY</code>). To use the same formula for each of the regressions (or if
there is no missing data in <code>A</code> nor <code>Y</code>), a single character
formula may be input.</p></td>
    </tr>
    <tr>
      <th>SL_Qr</th>
      <td><p>A vector of characters or a list describing the Super Learner
library to be used for the reduced-dimension outcome regression.</p></td>
    </tr>
    <tr>
      <th>glm_Qr</th>
      <td><p>A character describing a formula to be used in the call to
<code>glm</code> for reduced-dimension outcome regression. Ignored if
<code>SL_Qr!=NULL</code>. The formula should use the variable name <code>'gn'</code>.</p></td>
    </tr>
    <tr>
      <th>returnModels</th>
      <td><p>A logical indicating whether to return model fits for the
propensity score and reduced-dimension regressions.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>A logical indicating whether to print status updates.</p></td>
    </tr>
    <tr>
      <th>maxIter</th>
      <td><p>A numeric that sets the maximum number of iterations the TMLE
can perform in its fluctuation step.</p></td>
    </tr>
    <tr>
      <th>tolIC</th>
      <td><p>A numeric that defines the stopping criteria based on the
empirical mean of the influence function.</p></td>
    </tr>
    <tr>
      <th>tolg</th>
      <td><p>A numeric indicating the minimum value for estimates of the
propensity score.</p></td>
    </tr>
    <tr>
      <th>cvFolds</th>
      <td><p>A numeric equal to the number of folds to be used in
cross-validated fitting of nuisance parameters. If <code>cvFolds = 1</code>, no
cross-validation is used.</p></td>
    </tr>
    <tr>
      <th>gn</th>
      <td><p>An optional list of propensity score estimates. If specified, the
function will ignore the nuisance parameter estimation specified by
<code>SL_g</code> and <code>glm_g</code>. The entries in the list should correspond to
the propensity for the observed values of <code>W</code>, with order determined by
the input to <code>a_0</code> (e.g., if <code>a_0 = c(0,1)</code> then <code>gn[[1]]</code>
should be propensity of <code>A</code> = 0 and <code>gn[[2]]</code> should be propensity
of <code>A</code> = 1).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other options (not currently used).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>"adaptive_iptw"</code>.</p><dl>
 <dt><code>iptw_tmle</code></dt><dd><p>A <code>list</code> of point estimates and
       covariance matrix for the IPTW estimator based on a targeted
       propensity score.</p></dd>
 <dt><code>iptw_tmle_nuisance</code></dt><dd><p>A <code>list</code> of the final TMLE estimates
       of the propensity score (<code>$gnStar</code>) and reduced-dimension
       regression (<code>$QrnStar</code>) evaluated at the observed data values.</p></dd>
 <dt><code>iptw_os</code></dt><dd><p>A <code>list</code> of point estimates and covariance matrix
       for the one-step correct IPTW estimator.</p></dd>
 <dt><code>iptw_os_nuisance</code></dt><dd><p>A <code>list</code> of the initial estimates of the
       propensity score and reduced-dimension regression evaluated at the
       observed data values.</p></dd>
 <dt><code>iptw</code></dt><dd><p>A <code>list</code> of point estimates for the standard IPTW
       estimator. No estimate of the covariance matrix is provided because
       theory does not support asymptotic Normality of the IPTW estimator if
       super learning is used to estimate the propensity score.</p></dd>
 <dt><code>gnMod</code></dt><dd><p>The fitted object for the propensity score. Returns
       <code>NULL</code> if <code>returnModels = FALSE</code>.</p></dd>
 <dt><code>QrnMod</code></dt><dd><p>The fitted object for the reduced-dimension regression
       that guards against misspecification of the outcome regression.
       Returns <code>NULL</code> if <code>returnModels = FALSE</code>.</p></dd>
 <dt><code>a_0</code></dt><dd><p>The treatment levels that were requested for computation
       of covariate-adjusted means.</p></dd>
 <dt><code>call</code></dt><dd><p>The call to <code>adaptive_iptw</code>.</p></dd>

</dl>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># load super learner</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/ecpolley/SuperLearner'>SuperLearner</a></span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Loading required package: nnls</span></div><div class='output co'>#&gt; <span class='message'>Super Learner</span></div><div class='output co'>#&gt; <span class='message'>Version: 2.0-26</span></div><div class='output co'>#&gt; <span class='message'>Package created on 2019-10-27</span></div><div class='input'><span class='co'># simulate data</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123456</span><span class='op'>)</span>
<span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fl'>100</span>
<span class='va'>W</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>W1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>, W2 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>A</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Binomial.html'>rbinom</a></span><span class='op'>(</span><span class='va'>n</span>, <span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='va'>W</span><span class='op'>$</span><span class='va'>W1</span> <span class='op'>-</span> <span class='va'>W</span><span class='op'>$</span><span class='va'>W2</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>Y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Binomial.html'>rbinom</a></span><span class='op'>(</span><span class='va'>n</span>, <span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/stats/Logistic.html'>plogis</a></span><span class='op'>(</span><span class='va'>W</span><span class='op'>$</span><span class='va'>W1</span> <span class='op'>*</span> <span class='va'>W</span><span class='op'>$</span><span class='va'>W2</span> <span class='op'>*</span> <span class='va'>A</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># fit iptw with maxIter = 1 to run fast</span>
<span class='co'># \donttest{</span>
<span class='va'>fit1</span> <span class='op'>&lt;-</span> <span class='fu'>adaptive_iptw</span><span class='op'>(</span>
  W <span class='op'>=</span> <span class='va'>W</span>, A <span class='op'>=</span> <span class='va'>A</span>, Y <span class='op'>=</span> <span class='va'>Y</span>, a_0 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>0</span><span class='op'>)</span>,
  SL_g <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"SL.glm"</span>, <span class='st'>"SL.mean"</span>, <span class='st'>"SL.step"</span><span class='op'>)</span>,
  SL_Qr <span class='op'>=</span> <span class='st'>"SL.npreg"</span>, maxIter <span class='op'>=</span> <span class='fl'>1</span>
<span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Loading required package: nloptr</span></div><div class='output co'>#&gt; <span class='warning'>Warning: UNRELIABLE VALUE: Future (‘future_lapply-1’) unexpectedly generated random numbers without specifying argument 'future.seed'. There is a risk that those random numbers are not statistically sound and the overall results might be invalid. To fix this, specify 'future.seed=TRUE'. This ensures that proper, parallel-safe random numbers are produced via the L'Ecuyer-CMRG method. To disable this check, use 'future.seed=NULL', or set option 'future.rng.onMisuse' to "ignore".</span></div><div class='output co'>#&gt; <span class='warning'>Warning: UNRELIABLE VALUE: Future (‘future_lapply-1’) unexpectedly generated random numbers without specifying argument 'future.seed'. There is a risk that those random numbers are not statistically sound and the overall results might be invalid. To fix this, specify 'future.seed=TRUE'. This ensures that proper, parallel-safe random numbers are produced via the L'Ecuyer-CMRG method. To disable this check, use 'future.seed=NULL', or set option 'future.rng.onMisuse' to "ignore".</span></div><div class='output co'>#&gt; <span class='warning'>Warning: UNRELIABLE VALUE: Future (‘future_lapply-1’) unexpectedly generated random numbers without specifying argument 'future.seed'. There is a risk that those random numbers are not statistically sound and the overall results might be invalid. To fix this, specify 'future.seed=TRUE'. This ensures that proper, parallel-safe random numbers are produced via the L'Ecuyer-CMRG method. To disable this check, use 'future.seed=NULL', or set option 'future.rng.onMisuse' to "ignore".</span></div><div class='input'><span class='co'># }</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Benkeser.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


