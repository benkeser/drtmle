<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Compute asymptotically linear IPTW estimators with super learning 
for the propensity score — adaptive_iptw • drtmle</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">drtmle</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/using_drtmle.html">`drtmle`: Doubly-Robust Inference in R</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute asymptotically linear IPTW estimators with super learning 
for the propensity score</h1>
    </div>

    
    <p>Compute asymptotically linear IPTW estimators with super learning 
for the propensity score</p>
    

    <pre class="usage"><span class='fu'>adaptive_iptw</span>(<span class='no'>W</span>, <span class='no'>A</span>, <span class='no'>Y</span>, <span class='kw'>DeltaY</span> <span class='kw'>=</span> <span class='fu'>as.numeric</span>(!<span class='fu'>is.na</span>(<span class='no'>Y</span>)),
  <span class='kw'>DeltaA</span> <span class='kw'>=</span> <span class='fu'>as.numeric</span>(!<span class='fu'>is.na</span>(<span class='no'>A</span>)), <span class='kw'>stratify</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='kw'>if</span> (<span class='fu'>all</span>(<span class='no'>Y</span>
  <span class='kw'>%in%</span> <span class='fu'>c</span>(<span class='fl'>0</span>, <span class='fl'>1</span>))) {     <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/stats/topics/family'>binomial</a></span>() } <span class='kw'>else</span> {     <span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/stats/topics/family'>gaussian</a></span>() },
  <span class='kw'>a_0</span> <span class='kw'>=</span> <span class='fu'>unique</span>(<span class='no'>A</span>[!<span class='fu'>is.na</span>(<span class='no'>A</span>)]), <span class='kw'>SL_g</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>glm_g</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>SL_Qr</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>glm_Qr</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>returnModels</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>maxIter</span> <span class='kw'>=</span> <span class='fl'>2</span>,
  <span class='kw'>tolIC</span> <span class='kw'>=</span> <span class='fl'>1</span>/<span class='fu'>length</span>(<span class='no'>Y</span>), <span class='kw'>tolg</span> <span class='kw'>=</span> <span class='fl'>0.01</span>, <span class='kw'>cvFolds</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>W</th>
      <td><p>A <code>data.frame</code> of named covariates</p></td>
    </tr>
    <tr>
      <th>A</th>
      <td><p>A vector of binary treatment assignment (assumed to be equal to 0 or 1)</p></td>
    </tr>
    <tr>
      <th>Y</th>
      <td><p>A numeric of continuous or binary outcomes.</p></td>
    </tr>
    <tr>
      <th>DeltaY</th>
      <td><p>Indicator of missing outcome (assumed to be equal to 0 if missing 1 if observed)</p></td>
    </tr>
    <tr>
      <th>DeltaA</th>
      <td><p>Indicator of missing treatment (assumed to be equal to 0 if missing 1 if observed)</p></td>
    </tr>
    <tr>
      <th>stratify</th>
      <td><p>A <code>boolean</code> indicating whether to estimate the missing outcome regression separately
for observations with different levels of <code>A</code> (if <code>TRUE</code>) or to pool across <code>A</code> (if <code>FALSE</code>).</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>A <code>family</code> object equal to either <code>binomial()</code> or <code>gaussian()</code>, 
to be passed to the <code>SuperLearner</code> or <code>glm</code> function.</p></td>
    </tr>
    <tr>
      <th>a_0</th>
      <td><p>A vector of treatment levels at which to compute the adjusted mean outcome.</p></td>
    </tr>
    <tr>
      <th>SL_g</th>
      <td><p>A vector of characters or a list describing the Super Learner library to be used 
for the propensity score. See <code>link{SuperLearner::SuperLearner}</code> for details.</p></td>
    </tr>
    <tr>
      <th>glm_g</th>
      <td><p>A character describing a formula to be used in the call to <code>glm</code> for the propensity score. Ignored
if <code>SL_g!=NULL</code>.</p></td>
    </tr>
    <tr>
      <th>SL_Qr</th>
      <td><p>A vector of characters or a list describing the Super Learner library to be used 
for the reduced-dimension outcome regression.</p></td>
    </tr>
    <tr>
      <th>glm_Qr</th>
      <td><p>A character describing a formula to be used in the call to <code>glm</code> for reduced-dimension outcome regression. Ignored
if <code>SL_Qr!=NULL</code>. The formula should use the variable name <code>'gn'</code>.</p></td>
    </tr>
    <tr>
      <th>returnModels</th>
      <td><p>A boolean indicating whether to return model fits for the propensity score
and reduced-dimension regressions.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>A boolean indicating whether to print status updates.</p></td>
    </tr>
    <tr>
      <th>maxIter</th>
      <td><p>A numeric that sets the maximum number of iterations the TMLE can perform in its fluctuation step.</p></td>
    </tr>
    <tr>
      <th>tolIC</th>
      <td><p>A numeric that defines the stopping criteria based on the empirical mean
of the scores of the fluctuation submodels submodels. Setting to <code>"default"</code></p></td>
    </tr>
    <tr>
      <th>tolg</th>
      <td><p>A numeric indicating the minimum value for estimates of the propensity score.</p></td>
    </tr>
    <tr>
      <th>cvFolds</th>
      <td><p>A numeric equal to the number of folds to be used in cross-validated fitting of 
nuisance parameters. If <code>cvFolds = 1</code>, no cross-validation is used.</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>A boolean indicating whether to use <code>foreach</code>
to estimate nuisance parameters in parallel. Only useful if there is a registered parallel
backend and <code>cvFolds &gt; 1</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other options (not currently used).</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>"adaptive_iptw"</code>.</p><dl class='dl-horizontal'>
 <dt><code>iptw_tmle</code></dt><dd><p>A <code>list</code> of point estimates and 
       covariance matrix for the IPTW estimator based on a targeted propensity 
		  score.</p></dd>
 <dt><code>iptw_tmle_nuisance</code></dt><dd><p>A <code>list</code> of the final TMLE estimates of the
       propensity score (<code>$gnStar</code>) and reduced-dimension regression (<code>$QrnStar</code>) 
		  evaluated at the observed data values.</p></dd>
 <dt><code>iptw_os</code></dt><dd><p>A <code>list</code> of point estimates and covariance matrix for the
		  one-step correct IPTW estimator.</p></dd>
 <dt><code>iptw_os_nuisance</code></dt><dd><p>A <code>list</code> of the initial estimates of the
       propensity score and reduced-dimension regression evaluated at the observed data values.</p></dd>
 <dt><code>iptw</code></dt><dd><p>A <code>list</code> of point estimates for the standard IPTW estimator. No
		  estimate of the covariance matrix is provided because theory does not support asymptotic
		  Normality of the IPTW estimator if super learning is used to estimate the propensity score.</p></dd>
 <dt><code>aiptw</code></dt><dd><p>A <code>list</code> of doubly-robust point estimates and non-doubly-robust
       covariance matrix for the standard AIPTW estimator.</p></dd>
 <dt><code>gcomp</code></dt><dd><p>A <code>list</code> of non-doubly-robust point estimates and non-doubly-robust
       covariance matrix for the standard G-computation estimator. If super learner is used
       there is no guarantee of correct inference for this estimator.</p></dd>
 <dt><code>QnMod</code></dt><dd><p>The fitted object for the outcome regression. Returns <code>NULL</code>
       if <code>returnModels = FALSE</code>.</p></dd>
 <dt><code>gnMod</code></dt><dd><p>The fitted object for the propensity score. Returns <code>NULL</code> if
       <code>returnModels = FALSE</code>.</p></dd>
 <dt><code>QrnMod</code></dt><dd><p>The fitted object for the reduced-dimension regression that guards 
       against misspecification of the outcome regression. Returns <code>NULL</code> if 
       <code>returnModels = FALSE</code>.</p></dd>
 <dt><code>a_0</code></dt><dd><p>The treatment levels that were requested for computation of 
       covariate-adjusted means.</p></dd>
 <dt><code>call</code></dt><dd><p>The call to <code>adaptive_iptw</code></p></dd>
</dl>

    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># load super learner</span>
<span class='fu'>library</span>(<span class='no'>SuperLearner</span>)</div><div class='output co'>#&gt; <span class='message'>Loading required package: nnls</span></div><div class='output co'>#&gt; <span class='message'>Super Learner</span></div><div class='output co'>#&gt; <span class='message'>Version: 2.0-22</span></div><div class='output co'>#&gt; <span class='message'>Package created on 2017-07-18</span></div><div class='input'><span class='co'># simulate data </span>
<span class='fu'>set.seed</span>(<span class='fl'>123456</span>)
<span class='no'>n</span> <span class='kw'>&lt;-</span> <span class='fl'>200</span>
<span class='no'>W</span> <span class='kw'>&lt;-</span> <span class='fu'>data.frame</span>(<span class='kw'>W1</span> <span class='kw'>=</span> <span class='fu'>runif</span>(<span class='no'>n</span>), <span class='kw'>W2</span> <span class='kw'>=</span> <span class='fu'>rnorm</span>(<span class='no'>n</span>))
<span class='no'>A</span> <span class='kw'>&lt;-</span> <span class='fu'>rbinom</span>(<span class='no'>n</span>,<span class='fl'>1</span>,<span class='fu'>plogis</span>(<span class='no'>W</span>$<span class='no'>W1</span> - <span class='no'>W</span>$<span class='no'>W2</span>))
<span class='no'>Y</span> <span class='kw'>&lt;-</span> <span class='fu'>rbinom</span>(<span class='no'>n</span>, <span class='fl'>1</span>, <span class='fu'>plogis</span>(<span class='no'>W</span>$<span class='no'>W1</span>*<span class='no'>W</span>$<span class='no'>W2</span>*<span class='no'>A</span>))

<span class='no'>fit1</span> <span class='kw'>&lt;-</span> <span class='fu'>adaptive_iptw</span>(<span class='kw'>W</span> <span class='kw'>=</span> <span class='no'>W</span>, <span class='kw'>A</span> <span class='kw'>=</span> <span class='no'>A</span>, <span class='kw'>Y</span> <span class='kw'>=</span> <span class='no'>Y</span>, <span class='kw'>a_0</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>1</span>,<span class='fl'>0</span>),
               <span class='kw'>SL_g</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"SL.glm"</span>,<span class='st'>"SL.mean"</span>,<span class='st'>"SL.step"</span>),
               <span class='kw'>SL_Qr</span><span class='kw'>=</span><span class='st'>"SL.npreg"</span>)</div><div class='output co'>#&gt; <span class='message'>Loading required package: nloptr</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by David Benkeser.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
